# é¡¹ç›®å¼€å‘æµç¨‹ç®€ä»‹

![img](https://api2.mubu.com/v3/document_image/05059ff0-99b1-47c7-a36f-02221b72b35f-7239137.jpg)

## éœ€æ±‚åˆ†æ
1. ç”¨æˆ·ç™»é™†
2. æ‹‰å–åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
3. æ— å¼‚å¸¸é€€å‡ºï¼ˆå®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯ï¼‰
4. ç§èŠ
5. ç¾¤èŠ
6. å‘é€æ–‡ä»¶
7. æœåŠ¡å™¨æ¨é€æ–°é—»

## ç•Œé¢è®¾è®¡



### ç”¨æˆ·ç™»é™†

![img](https://api2.mubu.com/v3/document_image/e487e434-1582-4e65-8f8e-68ce4c3d5ba8-7239137.jpg)

åŠŸèƒ½ï¼š

+ æ ¡éªŒåŠŸèƒ½
  + `checkUser(String userId, String pwd)`

### æŸ¥çœ‹åœ¨çº¿ç”¨æˆ·åˆ—è¡¨

![img](https://api2.mubu.com/v3/document_image/b7caa3ab-cdfd-46d6-bf8f-620e93933cad-7239137.jpg)



### ç§èŠ

![img](https://api2.mubu.com/v3/document_image/3261fd86-cf91-4d39-ac9f-ddfcb2845d62-7239137.jpg)



### ç¾¤èŠ

![img](https://api2.mubu.com/v3/document_image/5d7368e2-cf85-4738-af0b-a5e6b2c13948-7239137.jpg)



### å‘æ–‡ä»¶

![img](https://api2.mubu.com/v3/document_image/48af7407-4d1e-4b3d-a472-48351b6fc0cc-7239137.jpg)



### æœåŠ¡å™¨æ¨é€æ–°é—»

![img](https://api2.mubu.com/v3/document_image/99c6e082-086c-4399-8e78-40bce738e489-7239137.jpg)



## åŠŸèƒ½æ¶‰åŠçŸ¥è¯†ç‚¹ï¼Œå¤§æ¦‚è½®å»“

### ç½‘ç»œç¼–ç¨‹TCPæ–¹å¼

#### socket

#### æ•°æ®ç®¡é“ä¼ å…¥Messageå¯¹è±¡å’ŒUserå¯¹è±¡

- ï¼Ÿä¸ºä»€ä¹ˆè¦ä¼ å…¥å¯¹è±¡ï¼Ÿè¿˜è¦ä¸²è¡ŒåŒ–ï¼ˆä¸å°±æ˜¯ç®€å•å‘ä¸€ä¸ªæ¶ˆæ¯å˜›ï¼‰
  å¯¹è±¡ä¼ è¾“ï¼Œè§£å†³æ–‡æœ¬ä¼ è¾“ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ç»“å°¾çš„é—®é¢˜ï¼Œmessageæœ‰ä¸åŒçš„ç±»å‹æ¥æ§åˆ¶æœåŠ¡å™¨è¿”å›ä»€ä¹ˆæ ·å¼ï¼Œä¼ å…¥å¯¹è±¡æ–¹ä¾¿åšå„ç§é€»è¾‘

#### åˆ›å»ºç«¯å£ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯é€šè¿‡è¿™ä¸€ä¸ªç«¯å£å¯åŠ¨æœåŠ¡å™¨çš„å¤šä¸ªsocketå¯¹è±¡

#### å¤šçº¿ç¨‹

- æœåŠ¡å™¨å‡ºç°äº†å¤šä¸ªsocket

  - ä¸ºäº†è¾¾åˆ°å®æ—¶é€šè®¯ï¼Œè¦æ±‚å®ç°å¤šçº¿ç¨‹ï¼Ÿ

  - å¹¶ä¸”å°†socketæ”¾åœ¨ä¸€ä¸ªé›†åˆä¸­

    - ç®¡ç†çº¿ç¨‹çš„é›†åˆï¼ˆvectorï¼‰ï¼Œçº¿ç¨‹æ± ï¼Ÿ

    - å°†è¿æ¥å¥½çš„é€šé“æ”¾åœ¨äº†ä¸€ä¸ªå®¹å™¨é‡Œï¼Œéœ€è¦çš„æ—¶å€™ç›´æ¥è°ƒç”¨è¿æ¥

- ï¼Ÿå®¢æˆ·ç«¯ä¹Ÿè¦å®ç°çº¿ç¨‹ï¼Ÿ

  - å®¢æˆ·ç«¯ä¹Ÿè¦æ±‚å®ç°å¤šçº¿ç¨‹

  - æ¯ä¸ªçº¿ç¨‹åˆ†åˆ«æ‰¿æ‹…ä¸åŒçš„åŠŸèƒ½

    - è§†é¢‘

    - æ–‡ä»¶å‘é€

    - æ¶ˆæ¯ä¼ é€’

  - ä¹Ÿéœ€è¦ç”¨Vectorç®¡ç†çº¿ç¨‹

#### ä»£ç å®ç°æ€è·¯

- æœåŠ¡ç«¯
  - æ€è·¯
    æœ‰å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡ç«¯æ—¶ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªsocket
    å¯åŠ¨çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹æŒæœ‰è¯¥socketå¯¹è±¡ï¼ˆsocketæ˜¯è¯¥çº¿ç¨‹å±æ€§ï¼‰
    ä½¿ç”¨é›†åˆæ¥ç®¡ç†çº¿ç¨‹

- å®¢æˆ·ç«¯

  - æ€è·¯
    å’ŒæœåŠ¡ç«¯é€šä¿¡æ—¶ï¼Œä½¿ç”¨å¯¹è±¡æ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨å¯¹è±¡æµå°†å¯¹è±¡è¯»å†™å…¥æ•°æ®é€šé“
    å½“å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡ç«¯åï¼Œä¹Ÿä¼šå¾—åˆ°socket
    å¯åŠ¨çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹æŒæœ‰socketå¯¹è±¡
    ä½¿ç”¨é›†åˆç®¡ç†çº¿ç¨‹

  - æ¨¡å—
    - QQView
      - èœå•ç•Œé¢ï¼ˆç®¡ç†ä¸€çº§èœå•å’ŒäºŒçº§èœå•ï¼‰
        å¸ƒå°”é‡ loop ç”¨æ¥æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºèœå•

- æ•°æ®åº“
  - è´¦æˆ·æ¶‰åŠ
    - æ²¡æœ‰å­¦ä¹ æ•°æ®åº“
      æš‚æ—¶ä½¿ç”¨äººä¸ºè§„å®šçš„ï¼šç”¨æˆ·å/id = 100ï¼Œå¯†ç  123456
      åªæœ‰è¿™ä¸ªç”¨æˆ·å¯ä»¥ç™»é™†ï¼Œå…¶å®ƒç”¨æˆ·ä¸èƒ½ç™»é™†
      æ‰©å±•ï¼Œä½¿ç”¨HashMapæ¨¡æ‹Ÿæ•°æ®åº“å®ç°å¤šç”¨æˆ·ç™»å½•

- ä¸¤ä¸ªå¯¹è±¡

  - Messageå¯¹è±¡
    å‘é€è€… sender
    æ¥æ”¶è€… getter
    å†…å®¹ content
    å‘é€æ—¶é—´ sendtime
    æ¶ˆæ¯ç±»å‹ mesType
  - Userå¯¹è±¡
    ID
    å¯†ç 
  - ç»†èŠ‚
    ä½¿ç”¨å¯¹è±¡æµè¯»å–
    éœ€è¦åœ¨ä¸¤ä¸ªå¯¹è±¡é‡Œå®ç°åºåˆ—åŒ–Serializable
    ` private static final long serialVersionUID = 1L`;å¢å¼ºå…¼å®¹æ€§
    å› ä¸ºå¼€äº†ä¸¤ä¸ªIDEAï¼ˆæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼‰
    åº”è¯¥è¦å°†è¿™ä¸¤ä¸ªå¯¹è±¡å…±äº«åˆ°ä¸¤ä¸ªç«¯å£ä¸­
  
- é€€å‡ºè¿›ç¨‹

  + å®¢æˆ·ç«¯ï¼š
    1. åœ¨mainçº¿ç¨‹ä¸­è°ƒç”¨æ–¹æ³•ï¼Œç»™æœåŠ¡å™¨ç«¯å‘é€ä¸€ä¸ªé€€å‡ºç³»ç»Ÿçš„messageå¯¹è±¡
    2. è°ƒç”¨` System.exitï¼ˆ0ï¼‰`// æ­£å¸¸é€€å‡º
  + æœåŠ¡å™¨ç«¯ï¼š
    1. æœåŠ¡å™¨ç«¯æ”¶åˆ°é€€å‡ºç³»ç»Ÿçš„messageå¯¹è±¡å
    2. æŠŠè¿™ä¸ªçº¿ç¨‹æŒæœ‰çš„socketå…³é—­
    3. åœ¨å°†çº¿ç¨‹ä»é›†åˆä¸­ç§»é™¤

- ç§èŠ

  - å®¢æˆ·ç«¯ï¼š

    1. åˆ›å»ºç”¨æˆ·ï¼ˆå®¢æˆ·ç«¯Aï¼‰å¸Œæœ›ç»™æŸä¸ªå…¶ä»–åœ¨çº¿ç”¨æˆ·ï¼ˆå®¢æˆ·ç«¯Bï¼‰èŠå¤©çš„å†…å®¹

       > ä»£ç å®ç°éƒ¨åˆ†åœ¨` MessageClinentService`

       > è¯´æ˜ï¼š1. æ„å»ºæ¶ˆæ¯çš„å±æ€§ï¼Œæ¶ˆæ¯ç±»å‹ï¼Œå‘é€è€…ï¼Œæ¥æ”¶è€…ï¼Œå†…å®¹ï¼Œå‘é€æ—¶é—´` new Date().toString()`

       > 2.é€šè¿‡ç¼–å†™å¯¹è±¡è¾“å…¥æµï¼Œä»çº¿ç¨‹é›†åˆä¸­æ‹¿åˆ°å‘é€è€…çš„çº¿ç¨‹ï¼Œé€šè¿‡çº¿ç¨‹æ‹¿åˆ°socketç«¯å£

    2. å°†æ¶ˆæ¯æ„å»ºæˆMessageå¯¹è±¡ï¼Œé€šè¿‡å¯¹åº”çš„socketå‘é€ç»™æœåŠ¡å™¨

       >  é€šè¿‡å¯¹è±¡è¾“å…¥æµå°†æ¶ˆæ¯messageå†™å…¥æ•°æ®é€šé“ ` oos.writeObject(message);` 

    3. åœ¨å®¢æˆ·ç«¯Bçš„çº¿ç¨‹ä¸­è¯»å–å‘é€åˆ°çš„Messageå¯¹è±¡ï¼Œå¹¶æ˜¾ç¤ºï¼ˆæ­¤æ­¥å…ˆè¦ç­‰å¾…æœåŠ¡å™¨çš„æ•°æ®ï¼‰

  - æœåŠ¡å™¨ç«¯ï¼š

    1. å¯ä»¥è¯»å–åˆ°å®¢æˆ·ç«¯Aå‘é€ç»™å®¢æˆ·ç«¯Bçš„æ¶ˆæ¯ï¼Œï¼ˆåŸç†æ˜¯å®¢æˆ·ç«¯Aå…ˆå°†æ•°æ®å†™å…¥æœåŠ¡å™¨ä¸­Aç”¨æˆ·å¯¹åº”çš„socketï¼Œç„¶åæœåŠ¡å™¨æ‰¾åˆ°ç§èŠå¯¹åº”ç”¨æˆ·çš„socketä¼ å…¥ã€‚

       > åœ¨` ServerConnectClientThread`ç±»é‡Œåˆ›å»ºæ–°çš„else-ifåˆ†æ”¯

       >  æ–°å»º` getSocket`æ–¹æ³•`(ps: å¦‚æœæ˜¯å•ä¸ªçº¿ç¨‹çš„åŸè·¯è¿”å›ï¼Œç›´æ¥å¼•ç”¨socketå°±è¡Œï¼Œä½†å¦‚æœè¦å¾—åˆ°æœåŠ¡å™¨å®¢æˆ·ç«¯Bçš„socketï¼Œå°±éœ€è¦ç”¨getSocketçš„æ–¹å¼æå‰ä¿å­˜ä¸Šä¸€ä¸ªsocketï¼Œä¸çŸ¥é“ç†è§£çš„å¯¹ä¸å¯¹)` 

    2. ä»ç®¡ç†çº¿ç¨‹çš„é›†åˆä¸­ï¼Œé€šè¿‡Messageå¯¹è±¡çš„getIdæ–¹å¼è·å–åˆ°å¯¹åº”çº¿ç¨‹çš„socket

       > åœ¨çº¿ç¨‹é›†åˆä¸­æ‹¿åˆ°å¯¹åº”çš„çº¿ç¨‹ï¼š

       ```java
       ServerConnectClientThread serverConnectClientThread =
               ManagerServerConnectClientThread.getServerConnectClientThread(message.getSender());
       ```

       > åˆ›å»ºå¯¹è±¡è¾“å‡ºæµ

    3. å°†messageå¯¹è±¡è½¬å‘ä¸ªæŒ‡å®šç”¨æˆ·

       å†™å…¥æ¶ˆæ¯`(psï¼šå®ç°ç§èŠé€»è¾‘ï¼Œå°†contentå…ˆä¿å­˜åˆ°æ•°æ®åº“é‡Œï¼Œç­‰å¾…ç”¨æˆ·ä¸Šçº¿æ—¶ï¼Œé€šè¿‡æœåŠ¡å™¨å®æ—¶æ£€æµ‹ç”¨æˆ·åœ¨çº¿æƒ…å†µï¼Œè°ƒç”¨æ•°æ®åº“é‡Œçš„ä¿¡æ¯ç›´æ¥è¿”å›ç»™ä¸Šçº¿ç”¨æˆ·)`

- ç¾¤èŠ

  - ä¸ç§èŠæ€è·¯ç±»ä¼¼ï¼Œé‡ç‚¹æ˜¯åœ¨æœåŠ¡ç«¯ä¸­ï¼Œæ‹¿åˆ°çº¿ç¨‹é›†åˆhashMapï¼Œéå†é™¤äº†ç¾¤å‘è€…çš„æ‰€æœ‰çº¿ç¨‹ï¼Œæ‹¿åˆ°çº¿ç¨‹ä¹‹åå†åˆ›å»ºå¯¹è±¡æµï¼Œå°†æ¶ˆæ¯å†™å…¥ç»™æ‰€æœ‰å¯¹è±¡`(è¿™é‡Œæœ‰ç‚¹ä¸å¤ªç†è§£ä¸ºä»€ä¹ˆå¾ªç¯åˆ›å»ºäº†å¤šä¸ªå¯¹è±¡æµå´æ²¡æœ‰æŠ¥StreamCorruptedExceptioné”™è¯¯)`


#### BUG

- åºåˆ—åŒ–é—®é¢˜
  - ä½¿ç”¨å¯¹è±¡æµæ¥è¯»å†™æ•°æ®ï¼Œè¯»å†™çš„å¯¹è±¡éœ€è¦åºåˆ—åŒ–
    å¦åˆ™ä¼šæŠ¥æœªåºåˆ—åŒ–å¼‚å¸¸å’Œè¯»å†™é”™è¯¯

- ç©ºæŒ‡é’ˆ
  æŸ¥æ‰¾ä¹‹åæ˜¯å› ä¸ºæ‹‰å–åœ¨çº¿ç”¨æˆ·é‚£ä¸ªæ¨¡å—æ—¶ä½¿ç”¨user.getId æœ‰å¯èƒ½è¿”å›ä¸ºç©ºï¼Œæš‚æ—¶ä¸çŸ¥é“åŸå› ï¼Œåªèƒ½é€šè¿‡ä¼ å‚çš„æ–¹å¼å®ç°è¯¥åŠŸèƒ½

- è¿è¡Œå…³é—­Server | ClientæŠ¥é”™

  - ä¸»çº¿ç¨‹é€€å‡ºï¼Œå­çº¿ç¨‹å¹¶æ²¡æœ‰é€€å‡ºï¼Œå­çº¿ç¨‹ä¸€ç›´ç­‰å¾…ä¸»çº¿ç¨‹çš„æ•°æ®ä¼ è¾“ï¼Œå› æ­¤æŠ¥é”™

    è§£å†³ï¼š

    1. é€šè¿‡è®¾ç½®å®ˆæŠ¤çº¿ç¨‹çš„æ–¹å¼ï¼ˆä¸æ¨èï¼Œå®ˆæŠ¤çº¿ç¨‹ä¸å¯æ§ï¼Œæ²¡æœ‰åè¶³çš„æŠŠæ¡å°½é‡å°‘ä½¿ç”¨ï¼‰
    2. é€šè¿‡å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªé€€å‡ºç±»å‹çš„æ¶ˆæ¯ï¼Œåªè¦æ¥æ”¶åˆ°è¯¥æ¶ˆæ¯å…³é—­è¿›ç¨‹

- `StreamCorruptedException`

  - æœªåºåˆ—åŒ–æˆ–è€…åˆ›å»ºäº†ä¸€ä¸ªä»¥ä¸Šçš„å¯¹è±¡æµå¯¼è‡´

  - è™½ç„¶ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæˆ‘ä¸»èœå•å’ŒäºŒçº§èœå•åœ¨é€€å‡ºç•Œé¢æ”¾äº†åŒä¸€ä¸ªé€€å‡ºæ–¹æ³•ï¼Œé€šè¿‡å‘æœåŠ¡ç«¯å‘é€é€€å‡ºç±»å‹çš„æ¶ˆæ¯æ¥å…³é—­ä¸¤ä¸ªç«¯å£å’Œå¯¹åº”è¿›ç¨‹ï¼Œç„¶ååœ¨äºŒçº§èœå•é€€å‡ºåä¸çŸ¥é“ä¸ºä»€ä¹ˆloopæ²¡æœ‰å˜æˆfalseï¼Œåœ¨ä¸»èœå•åˆèµ°äº†ä¸€éï¼Œå¯¼è‡´äº§ç”Ÿäº†ä¸¤ä¸ªå¯¹è±¡æµ

  - äº§ç”Ÿé”™è¯¯åŸå› æœ‰

    1. å®¢æˆ·ç«¯å°‘å†™äº†å°†æ¶ˆæ¯ä¼ å…¥æ•°æ®é€šé“é‡Œ ` oos.writeObject(message);`

    2. å®¢æˆ·ç«¯å°‘å†™äº†å…³é—­è¿›ç¨‹çš„å‘½ä»¤ 

       ```
       System.out.println(u.getUserId() + " é€€å‡ºç³»ç»Ÿ ");
       System.exit(0);//ç»“æŸè¿›ç¨‹
       ```

    3. æƒ…å†µ9 case 9 é€€å‡ºåˆ†æ”¯debugæ²¡æœ‰æ‰§è¡Œï¼Œä¸çŸ¥åŸå› ï¼Œæ”¹æˆæƒ…å†µ5 case 5



# ç¨‹åºç»“æ„æ¡†æ¶

## å®¢æˆ·ç«¯ QQClient

### service

#### UserClientService[ğŸ”åˆ›å»ºçº¿ç¨‹]

+ ä¸¤ä¸ªæ ¸å¿ƒå±æ€§

  + User ï¼ˆè‡ªå®šä¹‰ç±»ï¼šåœ¨qqcommonç±»é‡Œï¼‰ 
  + Socket

+ æ–¹æ³•ï¼š

  + æ ¡éªŒç”¨æˆ·æ•°æ®ï¼š`boolean checkUser(String userId, String pwd) `

    + å…ˆåˆ›å»ºå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„è¿æ¥ï¼Œé€šè¿‡Socketæ•°æ®é€šé“ä¼ å…¥Userå¯¹è±¡ï¼Œåœ¨æœåŠ¡ç«¯`QQServer/QQServer/QQServer()`é‡Œæ ¡éªŒç”¨æˆ·åˆæ³•æ€§

      ```java
      QQClient/UserClientService
      private String LocalIP = "127.0.0.1";
      public boolean checkUser(String userId, String pwd) {
          boolean flag = false;
          // åˆ›å»ºUserå¯¹è±¡
          user.setUseId(userId);
          user.setPasswd(pwd);
          socket = new Socket(InetAddress.getByName(LocalIP), 9999);
                      // åˆ›å»ºå¯¹è±¡æµï¼Œä¼ è¾“Userå¯¹è±¡åˆ°æœåŠ¡ç«¯
                      ObjectOutputStream oos = new 			ObjectOutputStream(socket.getOutputStream());
                      oos.writeObject(user); // å‘é€Userå¯¹è±¡
      ```

    + è¯»å–ä»æœåŠ¡å™¨`QQServer/QQServer/UserVerify`å›å¤çš„Messageå¯¹è±¡: (**æ¶ˆæ¯ç±»å‹ï¼šã€æˆåŠŸ & å¤±è´¥ã€‘**)
    + æ¡ä»¶åˆ†æ”¯å¤„ç†ï¼š
      1. éªŒè¯æ¶ˆæ¯ç±»å‹ä¸ºæˆåŠŸï¼šåˆ›å»ºä¸€ä¸ªå’ŒæœåŠ¡å™¨`ServerConnectClientThread`çº¿ç¨‹å¯¹åº”çš„å®¢æˆ·ç«¯`ClientConnectServerThread`çº¿ç¨‹
      2. æŠŠçº¿ç¨‹æ”¾åœ¨é›†åˆé‡Œç»´æŠ¤**ï¼ˆå®é™…ä¸Šå¹¶æ²¡æœ‰ç”¨åˆ°è¿™ä¸ªå®¢æˆ·ç«¯çº¿ç¨‹é›†åˆï¼Œä½†åœ¨åæœŸå¯èƒ½ä¼šåœ¨ä¸€ä¸ªå®¢æˆ·ç«¯å¼€å¯å¤šä¸ªSocketç«¯å£ï¼Œæ‰€ä»¥éœ€è¦ç”¨é›†åˆç»´æŠ¤ï¼šä¾‹å¦‚å®ç°åŒæ—¶å‘é€æ–‡ä»¶å’ŒèŠå¤©åŠŸèƒ½ï¼Œå°±éœ€è¦å¤šä¸ªçº¿ç¨‹å¤šä¸ªSocketç«¯å£ï¼‰**
      3. éªŒè¯æ¶ˆæ¯ç±»å‹ä¸ºå¤±è´¥ï¼šå…³é—­ç«¯å£

  + æ‹‰å–åœ¨çº¿ç”¨æˆ·æ•°æ®ï¼š`void onlineFriendList(String userId)`:

    + æ ¸å¿ƒé€»è¾‘ï¼šå‘æœåŠ¡ç«¯`ServerConnectClientThread`å‘é€æ¶ˆæ¯ç±»å‹ä¸ºè¯·æ±‚éœ€è¦è·å¾—åœ¨çº¿ç”¨æˆ·æ•°æ®çš„Messageå’Œå½“å‰å®¢æˆ·ç«¯ç”¨æˆ·å

    + åˆ›å»ºå¯¹è±¡æµï¼Œä»ç®¡ç†çº¿ç¨‹é›†åˆä¸­æ‹¿å–å½“å‰å‘é€è¯·æ±‚çš„çº¿ç¨‹ï¼Œ`ManageClientConnectServerThread.getClientConnectServerThread(userId).getSocket()`ï¼Œå‘é€æ‹‰å–åœ¨çº¿ç”¨æˆ·ä¿¡æ¯çš„è¯·æ±‚ï¼ŒæœåŠ¡ç«¯`ServerConnectClientThread`é€šè¿‡ä¸å®¢æˆ·ç«¯`UserClientService`å¯¹åº”çš„æ•°æ®é€šé“è¯»å–è¯¥ä¿¡æ¯

      **(å®é™…ä¸Šå› ä¸ºæ²¡æœ‰å®ç°ä¸€ä¸ªå®¢æˆ·ç«¯å¤šä¸ªçº¿ç¨‹çš„é€»è¾‘ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥ç›´æ¥ä»å½“å‰ç«¯å£ä¸­è·å–å¯¹è±¡æµ)**

    + æœåŠ¡ç«¯æ¥æ”¶åˆ°æ¶ˆæ¯åä»ç®¡ç†çº¿ç¨‹çš„é›†åˆä¸­æ‹‰å–å‡ºæ‰€æœ‰åœ¨çº¿ç”¨æˆ·çš„çº¿ç¨‹ï¼Œé€šè¿‡å†…éƒ¨å°è£…çš„æ–¹æ³•è¿”å›å®¢æˆ·ç«¯`ClientConnectServerThread`åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ã€‚

#### ClientConnectServerThreadï¼ˆæ ¸å¿ƒï¼‰ï¼š

+ æ„é€ å™¨å°è£…ä¸€ä¸ªSocketå¯¹è±¡ï¼Œä¿æŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æ•°æ®é€šè®¯

+ çº¿ç¨‹éƒ¨åˆ†ï¼š

  + åˆ›å»ºå¯¹è±¡æµï¼Œå¦‚æœæœåŠ¡ç«¯æ²¡æœ‰å‘é€Messageå¯¹è±¡ï¼Œçº¿ç¨‹ä¼šé˜»å¡åœ¨æ¥æ”¶Messageå¯¹è±¡çš„è¯­å¥ä¸­ï¼›

  + é€šè¿‡å¯¹è±¡æµè¯»å–Messageæ¶ˆæ¯ç±»å‹çš„ç»“æœï¼Œæ¡ä»¶åˆ†æ”¯å¤„ç†Messageç±»å‹çš„ä¸šåŠ¡

### utils

### viewï¼š

### QQViewï¼š

+ ç¨‹åºå…¥å£

+ å­˜æ”¾ä¸»èœå•å’ŒäºŒçº§èœå•

  + ä¸»èœå•ï¼š

    + ç”¨æˆ·æ ¡éªŒå‡½æ•°ï¼š`userClientService.checkUser(String userId,String pwd)`

  + äºŒçº§èœå•ï¼š

    1. æ˜¾ç¤ºåœ¨çº¿ç”¨æˆ·ï¼š`userClientService.onlineFriendList(String userId)`

    2. ç¾¤å‘æ¶ˆæ¯ï¼š`messageClientService.sendMessageToAll(String content,String userId)`
    3. ç§èŠæ¶ˆæ¯ï¼š`messageClientService.sendMessageToOne(String content,String userId,String getterId)`

### qqcommon

#### Message

+ å®ç°åºåˆ—åŒ–æ¥å£`Serializable`

+ å±æ€§ï¼š

  ```java
  private String sender; // å‘é€è€…
  private String getter; // æ¥æ”¶è€…
  private String content; // æ¶ˆæ¯å†…å®¹
  private String sendTime; // å‘é€æ—¶é—´
  private String mesType; // æ¶ˆæ¯ç±»å‹[æˆåŠŸ & å¤±è´¥]
  
  private byte[] fileBytes;
  private int fileLen = 0;
  private String dest; // ç›®æ ‡è·¯å¾„
  private String src; // æºæ–‡ä»¶è·¯å¾„
  ```

  + æ¶ˆæ¯ç±»å‹å®ç°äº†MessageTypeæ–¹æ³•ï¼š

    ```java
    String MESSAGE_LOGIN_SUCCEED = "1"; // è¡¨ç¤ºç™»é™†æˆåŠŸ
    String MESSAGE_LOGIN_FAIL = "2"; // è¡¨ç¤ºç™»é™†å¤±è´¥
    String MESSAGE_COMM_MES = "3"; // æ™®é€šæ¶ˆæ¯åŒ…
    String MESSAGE_GET_ONLINE_FRIEND = "4"; // è¯·æ±‚è¿”å›åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
    String MESSAGE_RET_ONLINE_FRIEND = "5"; // è¿”å›åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
    String MESSAGE_CLIENT_EXIT = "6"; // å®¢æˆ·ç«¯é€€å‡ºè¯·æ±‚
    String MESSAGE_TO_ALL_MES = "7"; // ç¾¤å‘æ¶ˆæ¯åŒ…
    String MESSAGE_OFFLINE_MES = "9"; // ç¦»çº¿æ¶ˆæ¯
    String MESSAGE_FILE_MES = "8"; // æ–‡ä»¶æ¶ˆæ¯ï¼ˆå‘é€æ–‡ä»¶ï¼‰
    ```





## æœåŠ¡ç«¯ QQServer

### service

#### QQServer[ğŸ”åˆ›å»ºçº¿ç¨‹]

+ åˆ›å»ºæœåŠ¡ç«¯å‘é€æ–°é—»çº¿ç¨‹`new Thread(new SendNewsToAllService()).start();`
+ æ­»å¾ªç¯ç›‘å¬å®¢æˆ·ç«¯`Socket socket = serverSocket.accept();`
  + åˆ›å»ºå¯¹è±¡æµè¯»å–å®¢æˆ·ç«¯`QQClient/UserClientService/checkUser`ä¼ å…¥çš„userå¯¹è±¡

+ ä½¿ç”¨é™æ€ä»£ç å—ï¼ˆä½¿å…¶åœ¨ç±»åŠ è½½æ—¶ä¾¿è¢«åˆ›å»ºï¼‰åˆå§‹åŒ–åœ¨`ConcurrentHashMap`é›†åˆé‡Œçš„`validUsers`ï¼ˆç”¨æˆ·æ•°æ®ï¼‰
  + HashMapæ²¡æœ‰å¤„ç†çº¿ç¨‹å®‰å…¨ï¼Œæ‰€ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹å°½é‡ä½¿ç”¨`ConcurrentHashMap`é›†åˆ
  + åˆæœŸæ˜¯åˆ›å»ºUserï¼Œpwdä¸¤ä¸ªç§æœ‰å±æ€§æ¥å®ç°ç”¨æˆ·æ ¡éªŒåŠŸèƒ½ï¼Œç°ä»£ç ä½¿ç”¨é›†åˆç»´æŠ¤å¤šç”¨æˆ·ä¿¡æ¯ï¼ŒåæœŸè¿˜å¯ä»¥æ”¾åœ¨æ•°æ®åº“é‡Œ
+ å¤šç”¨æˆ·éªŒè¯åŠŸèƒ½ï¼š`boolean checkUser(String userId,String passwd)`
  + æœ‰æ— id
  + å¯†ç pwdæ˜¯å¦æ­£ç¡®
  + è¿”å›booleanå€¼
+ å¤šç”¨æˆ·æ ¡éªŒåŠŸèƒ½(æ ¸å¿ƒ):`void UserVerify(User user, Socket socket)`
  + åˆ›å»ºMessageå¯¹è±¡ï¼ˆqqcommonåŒ…ä¸­çš„ç±»ï¼‰
  + åˆ›å»ºå¯¹è±¡æµä¼ è¾“Messageå¯¹è±¡
  + åˆ›å»ºçº¿ç¨‹`ServerConnectClientThread`ï¼Œçº¿ç¨‹é‡ŒæŒæœ‰socketå¯¹è±¡ï¼Œç»´æŒä¸å®¢æˆ·ç«¯QQClientçš„æ•°æ®é€šé“
  + å°†çº¿ç¨‹æ”¾åœ¨`ManagerServerConnectClientThread`é‡Œç»´æŠ¤ï¼šä¸ºäº†åç»­æ‹‰å–åœ¨çº¿ç”¨æˆ·åšå‡†å¤‡ï¼Œæ¯ä¸€æ¬¡ç›‘å¬å®¢æˆ·ç«¯çš„æ•°æ®é€šé“ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ã€‚**å®¢æˆ·ç«¯ç™»é™†ç”¨æˆ·æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ç”¨æˆ·æ ¡éªŒï¼Œè¿™æ—¶å€™å°±ä¼šå‘é€æ¶ˆæ¯å‘æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯é€šè¿‡accpectç›‘å¬å®¢æˆ·ç«¯çš„æ•°æ®é€šé“**

  

#### `ServerConnectClientThread`ï¼ˆæ ¸å¿ƒï¼‰:

+ ä½œç”¨ï¼šåˆ›å»ºçº¿ç¨‹ï¼Œå°†ç”¨æˆ·åå’Œç«¯å£Socketç»‘å®šï¼Œç»´æŒå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ•°æ®é€šé“è¿æ¥

+ åˆ›å»ºå¯¹è±¡æµï¼Œå‡†å¤‡è¯»å†™å¯¹è±¡

  ```java
  ObjectInputStream ois = new ObjectInputStream(socket.getInputStream());
  Message message = (Message) ois.readObject();// å‘ä¸‹è½¬å‹å¯¹è±¡æµï¼Œä½¿å…¶å˜æˆæ¶ˆæ¯ç±»å‹
  ```

+ æ¡ä»¶å¤„ç†Messageç±»å‹

  + æ‹‰å–åœ¨çº¿ç”¨æˆ·ï¼šä»`ManagerServerConnectClientThread.getOnlineUser()`è°ƒç”¨hashMapé›†åˆä¸­æ‰€æœ‰çš„ç”¨æˆ·







#### ManagerServerConnectClientThread

+ ä½œç”¨ï¼šå­˜æ”¾æœåŠ¡å™¨ç«¯å£çº¿ç¨‹çš„é›†åˆ
+ ä½¿ç”¨HashMapè¿›è¡Œå®¢æˆ·ç«¯ç”¨æˆ·åå’Œç«¯å£Socketçš„ç»‘å®š**ï¼ˆHashMapé‡Œé¢çš„<k-v>:keyä¿å­˜String userIdï¼Œvalueä¿å­˜å¯¹åº”ç”¨æˆ·åçš„çº¿ç¨‹ï¼‰**
+ æ–¹æ³•ï¼š
  + æ·»åŠ çº¿ç¨‹åˆ°é›†åˆ`void addClientThread(String userId,ServerConnectClientThread serverConnectClientThread)`
    + åœ¨QQserverç±»é‡Œè¢«è°ƒç”¨ï¼Œæ¯ä¸€æ¬¡ç›‘å¬å®¢æˆ·ç«¯æ•°æ®é€šé“å°±ä¼šå¼€è¾Ÿä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œå¹¶å°†è¯¥çº¿ç¨‹æ”¾åˆ°é›†åˆä¸­ã€‚



